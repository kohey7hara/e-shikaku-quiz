<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eè³‡æ ¼ å¾¹åº•æ”»ç•¥ã‚¯ã‚¤ã‚º (å®Œå…¨ç¶²ç¾…ç‰ˆ)</title>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary-color: #2E7D32;
            --wrong-color: #D32F2F;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --text-color: #333;
        }
        body { font-family: sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; background: var(--card-bg); padding: 20px; border-radius: 12px; min-height: 80vh; }
        h1 { text-align: center; color: var(--primary-color); }
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin: 20px 0; }
        .category-btn { padding: 12px; background: #fff; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; text-align: center; }
        .category-btn.selected { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .action-btn { width: 100%; padding: 15px; margin-top: 20px; background: var(--primary-color); color: white; border: none; border-radius: 30px; cursor: pointer; font-size: 1.1rem; }
        .option-btn { width: 100%; padding: 15px; margin-bottom: 10px; border: 2px solid #ddd; background: white; text-align: left; cursor: pointer; border-radius: 8px; }
        .option-btn.correct { background: #E8F5E9; border-color: var(--primary-color); color: var(--primary-color); }
        .option-btn.wrong { background: #FFEBEE; border-color: var(--wrong-color); color: var(--wrong-color); }
        .explanation-area { display: none; margin-top: 20px; padding: 20px; background: #F1F8E9; border-left: 5px solid var(--primary-color); }
    </style>
</head>
<body>

<div class="container">
    <div id="start-screen">
        <h1>ğŸ“ Eè³‡æ ¼ å¾¹åº•æ”»ç•¥</h1>
        <p style="text-align:center;">å…¨ç¯„å›²å®Œå…¨ç¶²ç¾… (100å•è¶…)</p>
        <div class="category-grid" id="category-grid"></div>
        <button class="action-btn" onclick="startQuiz()">ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã™ã‚‹</button>
    </div>

    <div id="quiz-screen" style="display:none;">
        <div style="text-align:right;">æ­£è§£æ•°: <span id="current-score">0</span> | å•é¡Œ: <span id="current-count">1</span> / <span id="total-count">0</span></div>
        <h3 id="category-tag" style="color:var(--primary-color);"></h3>
        <div id="question-text" style="font-size:1.1rem; font-weight:bold; margin-bottom:20px;"></div>
        <div id="options-container"></div>
        <div class="explanation-area" id="explanation-area">
            <h3 id="result-title"></h3>
            <div id="explanation-text"></div>
        </div>
        <button class="action-btn" id="next-btn" style="display:none;" onclick="nextQuestion()">æ¬¡ã®å•é¡Œã¸ â¡</button>
    </div>

    <div id="result-screen" style="display:none; text-align:center;">
        <h2>å­¦ç¿’å®Œäº†ï¼</h2>
        <h1><span id="final-percentage">0%</span></h1>
        <p>æ­£è§£æ•°: <span id="final-correct">0</span> / <span id="final-total">0</span></p>
        <button class="action-btn" onclick="location.reload()">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
    </div>
</div>

<script src="questions_1.js"></script>
<script src="questions_2.js"></script>
<script src="questions_3.js"></script>

<script>
    // ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆ
    let quizData = [];
    if (typeof part1 !== 'undefined') quizData = quizData.concat(part1);
    if (typeof part2 !== 'undefined') quizData = quizData.concat(part2);
    if (typeof part3 !== 'undefined') quizData = quizData.concat(part3);

    let currentQuestions = [];
    let currentIndex = 0;
    let score = 0;

    window.onload = function() {
        if (quizData.length === 0) {
            alert("ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ« (questions_1.js ç­‰) ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚");
            return;
        }
        initCategories();
    };

    function initCategories() {
        const categories = [...new Set(quizData.map(q => q.category))];
        const grid = document.getElementById('category-grid');
        
        const allBtn = document.createElement('div');
        allBtn.className = 'category-btn selected';
        allBtn.innerText = 'ã™ã¹ã¦é¸æŠ';
        allBtn.onclick = function() {
            const isSelecting = !this.classList.contains('selected');
            this.classList.toggle('selected');
            document.querySelectorAll('.category-btn:not(:first-child)').forEach(btn => {
                if(isSelecting) btn.classList.add('selected');
                else btn.classList.remove('selected');
            });
        };
        grid.appendChild(allBtn);

        categories.forEach(cat => {
            const btn = document.createElement('div');
            btn.className = 'category-btn selected';
            btn.innerText = cat;
            btn.onclick = function() {
                this.classList.toggle('selected');
                const btns = document.querySelectorAll('.category-btn:not(:first-child)');
                const selected = document.querySelectorAll('.category-btn:not(:first-child).selected');
                if(btns.length === selected.length) allBtn.classList.add('selected');
                else allBtn.classList.remove('selected');
            };
            grid.appendChild(btn);
        });
    }

    function startQuiz() {
        const selectedButtons = document.querySelectorAll('.category-btn:not(:first-child).selected');
        const selectedCategories = Array.from(selectedButtons).map(btn => btn.innerText);
        if (selectedCategories.length === 0) return alert("ã‚«ãƒ†ã‚´ãƒªã‚’é¸ã‚“ã§ãã ã•ã„");

        const filtered = quizData.filter(q => selectedCategories.includes(q.category));
        currentQuestions = filtered.sort(() => Math.random() - 0.5);
        
        currentIndex = 0;
        score = 0;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        document.getElementById('total-count').innerText = currentQuestions.length;
        loadQuestion();
    }

    function loadQuestion() {
        const q = currentQuestions[currentIndex];
        document.getElementById('current-count').innerText = currentIndex + 1;
        document.getElementById('category-tag').innerText = q.category;
        document.getElementById('question-text').innerHTML = q.question;
        
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = opt;
            btn.onclick = () => checkAnswer(idx, btn);
            container.appendChild(btn);
        });
        document.getElementById('explanation-area').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        if (window.MathJax) MathJax.typesetPromise();
    }

    function checkAnswer(idx, btn) {
        const q = currentQuestions[currentIndex];
        document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
        const title = document.getElementById('result-title');
        if (idx === q.answer) {
            btn.classList.add('correct');
            title.innerText = "â­• æ­£è§£ï¼";
            score++;
        } else {
            btn.classList.add('wrong');
            document.querySelectorAll('.option-btn')[q.answer].classList.add('correct');
            title.innerText = "âŒ ä¸æ­£è§£...";
        }
        document.getElementById('explanation-text').innerHTML = q.explanation;
        document.getElementById('explanation-area').style.display = 'block';
        document.getElementById('next-btn').style.display = 'block';
        document.getElementById('current-score').innerText = score;
        if (window.MathJax) MathJax.typesetPromise();
    }

    function nextQuestion() {
        currentIndex++;
        if (currentIndex < currentQuestions.length) loadQuestion();
        else {
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-percentage').innerText = Math.round(score/currentQuestions.length*100) + "%";
            document.getElementById('final-correct').innerText = score;
            document.getElementById('final-total').innerText = currentQuestions.length;
        }
    }
</script>
</body>
</html>